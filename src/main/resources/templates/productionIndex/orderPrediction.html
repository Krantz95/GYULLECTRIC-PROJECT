<html layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<th:block layout:fragment="content">
    <div class="py-4">
        <!-- 서브타이틀 -->
        <div class="subtitle_css">생산지표관리_발주예측</div>

        <!-- KPI 요약 -->
        <div class="py-3">
            <div class="form_sm_css" style="border: 1px solid black; max-width: 1600px; padding: 20px 15px;">
                <div class="mb-2 fw-bold"> KPI 요약</div>
                <div class="ms-2"> 예상 총 발주량 : <span th:text="${predictedData != null ? #lists.sum(predictedData.^recommended) + '개' : '---'}"></span> </div>
                <div class="ms-2"> 적정 발주 시점 : <span th:text="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}"></span> </div>
                <div class="ms-2 fw-bold"> 과잉 재고 리스크 : <span style="color: red;">높음</span></div>
                <div class="ms-2"> 최근 수요 증가 품목 : 배터리팩, 모터 </div>
            </div>
        </div>

        <!-- 예측 입력 폼 -->
        <div class="m-3">
            <p class="pt-2 fw-bold">발주 예측</p>
            <form th:action="@{/indicators/order-predict}" method="post"
                  class="d-flex justify-content-start align-items-center mb-3 gap-2">
                <select name="product" class="pointer_orange form-select" style="width: 200px;" required>
                    <option value="">제품선택</option>
                    <option value="A타입">A타입</option>
                    <option value="B타입">B타입</option>
                    <option value="C타입">C타입</option>
                </select>
                <div>
                    <input type="date" name="startDate" class="form-control" required>
                </div>
                <div>
                    <input type="date" name="endDate" class="form-control" required>
                </div>
                <button type="submit" class="btn_search" style="color: white">예측 실행</button>
            </form>
        </div>

        <!-- 발주 예측 테이블 -->
        <div class="table-responsive pt-2" style="overflow-x: auto;">
            <table class="table2_css bold-column" style="color: black">
                <thead>
                <tr>
                    <th>부품명</th>
                    <th>현재 재고</th>
                    <th>예측수요량</th>
                    <th>권장발주량</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="row : ${predictedData}">
                    <td th:text="${row.part}">부품명</td>
                    <td th:text="${row.currentStock}">현재 재고</td>
                    <td th:text="${row.predicted}">예측 수요</td>
                    <td th:text="${row.recommended}">권장 발주</td>
                </tr>
                <tr th:if="${predictedData == null}">
                    <td colspan="4" class="text-center">예측 결과가 없습니다. 제품과 날짜를 선택해주세요.</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- 그래프는 유지 (원하는 경우 별도 처리 가능) -->
    </div>
</th:block>
</html>
