<html layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org">
<th:block layout:fragment="content">
    <div class="py-4">
        <!-- 서브타이틀 -->
        <div class="subtitle_css">📦 생산지표관리 <span class="en-font">_ 발주예측</span></div>

        <!-- KPI 요약 -->
        <div class="py-3" th:if="${predictedData != null}">
            <div class="form_sm_css shadow-sm border rounded" style="max-width: 1600px; padding: 20px 15px; background-color: #f9f9f9;">
                <div class="mb-2 fw-bold fs-5">📊 KPI 요약</div>
                <div class="ms-2">🧮 예상 총 발주량 :
                    <span class="fw-bold" th:text="${#aggregates.sum(predictedData, 'recommended')} + '개'">0개</span>
                </div>
                <div class="ms-2">🕒 적정 발주 시점 :
                    <span class="fw-semibold text-primary" th:text="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}">2025-06-01</span>
                </div>
                <div class="ms-2">🚨 과잉 재고 리스크 :
                    <span th:style="${#aggregates.sum(predictedData, 'recommended') > 500} ? 'color: red;' : 'color: green;'" class="fw-bold">
                        <span th:text="${#aggregates.sum(predictedData, 'recommended') > 500} ? '높음' : '낮음'">낮음</span>
                    </span>
                </div>
                <div class="ms-2">📈 최근 수요 증가 품목 : <span class="text-danger">배터리팩, 모터</span></div>
            </div>
        </div>

        <!-- 예측 입력 폼 -->
        <div class="m-3">
            <p class="pt-2 fw-bold">🔍 발주 예측</p>
            <form th:action="@{/indicators/order-predict}" method="post"
                  class="d-flex justify-content-start align-items-center mb-3 gap-2">
                <input type="date" name="startDate" class="form-control" th:value="${startDate}" required>
                <input type="date" name="endDate" class="form-control" th:value="${endDate}" required>
                <button type="submit" class="btn_search text-white">예측 실행</button>
            </form>
        </div>

        <!-- 예측 결과 테이블 -->
        <div class="table-responsive pt-2" style="overflow-x: auto;">
            <table class="table table-bordered text-center align-middle table2_css" style="color: black;">
                <thead class="table-light">
                <tr>
                    <th>부품명</th>
                    <th>현재 재고</th>
                    <th>예측 수요량</th>
                    <th>권장 발주량</th>
                    <th>발주 필요</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="row : ${predictedData}">
                    <td th:text="${row.part}">부품명</td>
                    <td th:text="${row.currentStock}">0</td>
                    <td th:text="${row.predicted}">0</td>
                    <td th:text="${row.recommended}">0</td>
                    <td>
                        <span class="badge"
                              th:classappend="${row.recommended > 0} ? 'bg-danger' : 'bg-success'"
                              th:text="${row.recommended > 0} ? '필요' : '불필요'">필요</span>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(predictedData)}">
                    <td colspan="5" class="text-center text-muted py-3">
                        🔎 예측 결과가 없습니다. 날짜를 선택한 뒤 예측을 실행해주세요.
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</th:block>
</html>
