<html layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<th:block layout:fragment="content">

    <div class="subtitle_css"><i class="bi-clipboard-check"></i> ìƒì‚°ì§€ì‹œì„œ</div>
    <div class="order-card">
        <h2 style="color:#FF6A00; font-weight: bold;">ğŸš² ìƒì‚°ì§€ì‹œì„œ</h2>

        <!-- ìƒì‚°ì§€ì‹œ í¼ -->
        <form th:action="@{/product/create}" th:object="${productOrderForm}" method="post">
            <div class="mb-3">
                <label for="bikeSelect">ìƒí’ˆëª…</label>
                <select id="bikeSelect" class="form-select custom-select" th:field="*{productName}" onchange="changeImage()" required>
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option th:each="productName : ${T(gyullectric.gyullectric.domain.ProductName).values()}"
                            th:text="${productName}" th:value="${productName}"></option>
                </select>
            </div>

            <div class="mb-3">
                <label for="quantityInput">ìˆ˜ëŸ‰</label>
                <input type="number" id="quantityInput" class="form-control" th:field="*{quantity}" placeholder="ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <button type="submit" class="submit-btn mt-3">ğŸš€ ìƒì‚° ì‹œì‘</button>

            <!-- ì—ëŸ¬ ëª¨ë‹¬ -->
            <div th:if="${(#fields != null and #fields.hasErrors()) or (errorMessage != null)}"
                 class="modal fade show d-block"
                 tabindex="-1"
                 style="background-color: rgba(0,0,0,0.5);"
                 role="dialog"
                 aria-modal="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content border border-black">
                        <div class="modal-header bg-secondary text-warning ">
                            <h5 class="modal-title">âš  ì˜¤ë¥˜ ë°œìƒ</h5>
                            <a th:href="@{/product/create}" class="btn-close" aria-label="Close"></a>
                        </div>
                        <div class="modal-body">
                            <ul>
                                <li th:each="err : ${#fields.allErrors()}" th:utext="${err}"></li>
                                <li th:if="${errorMessage}" th:text="${errorMessage}"></li>
                            </ul>
                        </div>
                        <div class="modal-footer">
                            <a th:href="@{/product/create}" class="btn btn-dark btn-lg">í™•ì¸</a>
                        </div>
                    </div>
                </div>
            </div>
        </form>

        <!-- ì˜¤ëŠ˜ ë‚ ì§œ & ì‚¬ìš©ì -->
        <div class="mt-4">
            <p><strong>ğŸ“… ì˜¤ëŠ˜ ë‚ ì§œ :</strong> <span th:text="${T(java.time.LocalDate).now()}"></span></p>
            <p><strong>ğŸ‘¤ ì£¼ë¬¸ì :</strong> <span th:text="${loginMember.name}">ì‚¬ìš©ìëª…</span></p>
        </div>

        <!-- ìì „ê±° ì¸ë„¤ì¼ 3ì¥ -->
        <div class="d-flex justify-content-between mb-4 mt-3">
            <img src="/images/bike1.jpg" alt="GyulRide" class="thumbnail-img" id="thumb-gyul">
            <img src="/images/bike2.jpg" alt="InteliBike" class="thumbnail-img" id="thumb-inteli">
            <img src="/images/bike3.jpg" alt="PedalAt4" class="thumbnail-img" id="thumb-pedal">
        </div>

        <!-- ì „ì²´ ì œí’ˆ ìƒì‚° í˜„í™© -->
        <div class="stats-box mt-4">
            <h5 style="color: #FF6A00;">ğŸ“Š ì „ì²´ ì œí’ˆ ìƒì‚° í˜„í™©</h5>
            <div class="stats-grid">
                <div th:each="entry : ${dailyTargetMap}" class="product-card">
                    <strong style="color:#FF6A00;" th:text="'ğŸš² ' + ${entry.key}"></strong><hr>
                    <span style="color:#FF9800;">ğŸ“¦ ëª©í‘œìˆ˜ëŸ‰ :</span>
                    <span th:text="${entry.value} + 'ëŒ€'"></span><br>
                    <span style="color:#4CAF50;">âœ… ìƒì‚°ì™„ë£Œ:</span>
                    <span th:text="${orderedCountMap[entry.key] != null ? orderedCountMap[entry.key] : 0} + 'ëŒ€'"></span><br>
                    <span style="color:#2196F3;">ğŸ›’ ê°€ëŠ¥ìˆ˜ëŸ‰:</span>
                    <span th:text="${entry.value - (orderedCountMap[entry.key] != null ? orderedCountMap[entry.key] : 0)} + 'ëŒ€'"></span>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        function changeImage() {
            const selected = document.getElementById("bikeSelect").value;
            const thumbs = document.querySelectorAll('.thumbnail-img');
            thumbs.forEach(img => img.classList.remove('active'));

            const activeId = {
                "GyulRide": "thumb-gyul",
                "InteliBike": "thumb-inteli",
                "PedalAt4": "thumb-pedal"
            }[selected];

            if (activeId) {
                const el = document.getElementById(activeId);
                if (el) el.classList.add("active");
            }
        }

        document.addEventListener("DOMContentLoaded", changeImage);
    </script>

</th:block>
</html>
