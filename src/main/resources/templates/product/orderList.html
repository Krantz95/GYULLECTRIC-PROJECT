<html layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<th:block layout:fragment="content">

    <div class="py-4">
        <!-- 서브타이틀 -->
        <div class="subtitle_css en-font">ORDER_ORDER LIST</div>

        <!-- 테이블 -->
        <div class="table-responsive pt-3" style="overflow-x: auto;"> <!-- sm사이즈에서는 스크롤 생성 -->
            <table class="table">
                <thead>
                <tr>
                    <th>제품명</th>
                    <th>수량</th>
                    <th>담당직원</th>
                    <th>주문날짜</th>
                    <th>납기일</th>
                    <th>공정상태</th>
                    <th>작업</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="jobOrder : ${jobOrders}">
                    <td th:text="${jobOrder.productName}">제품명</td>
                    <td th:text="${jobOrder.quantity}">수량</td>
                    <td th:text="${jobOrder.notiAuthor.loginId}">담당직원</td>
                    <td th:text="${#temporals.format(jobOrder.orderDate, 'yyyy-MM-dd HH:mm')}">주문날짜</td>
                    <td th:text="${jobOrder.dueDate}">납기일</td>
                    <td th:text="${jobOrder.processStatus}">공정상태</td>
                    <td>
                        <form th:action="@{/order/process/new/{id}(id=${jobOrder.id})}" method="post" th:if="${jobOrder.processStatus.name() == 'PENDING'}">
                            <button type="submit" class="btn btn-warning btn-sm">공정시작</button>
                        </form>

                        <button type="button"
                                class="btn btn-danger btn-sm"
                                data-bs-toggle="modal"
                                th:attr="data-bs-target='#deleteModal-' + ${jobOrder.id}"
                                th:if="${jobOrder.processStatus.name() == 'PENDING'}">
                            삭제
                        </button>

                        <a th:href="@{/monitoring}" class="btn btn-success btn-sm"
                           th:if="${jobOrder.processStatus.name() == 'COMPLETED'}">공정보기</a>

                        <button class="btn btn-warning btn-sm" disabled
                                th:if="${jobOrder.processStatus.name() == 'COMPLETED'}">공정시작</button>

                        <button class="btn btn-danger btn-sm" disabled
                                th:if="${jobOrder.processStatus.name() == 'COMPLETED'}">삭제</button>

                        <!-- 삭제 확인 모달 -->
                        <div class="modal fade" th:id="'deleteModal-' + ${jobOrder.id}" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteModalLabel">삭제 확인</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body" th:text="'정말로 ' + ${jobOrder.productName} + ' 주문을 삭제하시겠습니까?'"></div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                                        <a th:href="@{/order/delete/{id}(id=${jobOrder.id})}" class="btn btn-primary">삭제</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- 최소 모달창 -->
        <div class="modal" id="cancelModal2" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">작업 취소</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>해당 작업을 삭제하시겠습니까?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
                        <button type="button" class="btn" style="background-color: red; color: white">삭제</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</th:block>
</html>

