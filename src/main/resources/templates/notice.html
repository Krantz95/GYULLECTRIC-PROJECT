<html layout:decorate="~{layout}" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<th:block layout:fragment="alert">
    <div class="dashboard_error">
        <p style="margin: 0;">제 2공정 : 101 ERROR</p>
    </div>
    <div style="background-color: #FFC373; padding: 8px 0; text-align: start; vertical-align: middle;">
        <a href="/errors/report" class="btn_black ms-3" style="display: inline-flex; width: 120px; height: 40px; border-radius: 10px; background-color: #E2E2E2; color: #000000">REPORT</a>
        <a href="/dashboard/notice" class="btn_black ms-2" style="display: inline-flex; width: 120px; height: 40px; border-radius: 10px; background-color: #E2E2E2; color: #000000">공지사항</a>
    </div>
</th:block>

<!-- 본문 -->
<th:block layout:fragment="content">

    <div class="py-4">
        <div class="subtitle_css">공지게시판</div>

        <!-- 테이블 -->
        <div class="table-responsive pt-3">
            <table class="table table-bordered text-center align-middle table1_css">
                <thead>
                <tr>
                    <th>공지여부</th>
                    <th>제목</th>
                    <th>작성일</th>
                    <th>작성자</th>
                    <th>조회수</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td style="text-align: center;">
                        <input type="checkbox" class="row-checkbox" onchange="markAsNotice(this)" onclick="event.stopPropagation();" />
                    </td>
                    <td>5월 휴무 안내</td>
                    <td>2025-05-12</td>
                    <td>윤팀장</td>
                    <td>52</td>
                </tr>
                <tr>
                    <td style="text-align: center;">
                        <input type="checkbox" class="row-checkbox" onchange="markAsNotice(this)" onclick="event.stopPropagation();" />
                    </td>
                    <td>1공정 요즘 NG가 많습니다....</td>
                    <td>2025-05-10</td>
                    <td>최대표</td>
                    <td>1</td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="d-flex justify-content-end mt-3">
            <button type="button" class="write_css">글쓰기</button>
        </div>
    </div>

    <!-- 공지기능 추가 : 체크 선택하나만 + 새로고침 시 유지 -->
    <script th:inline="javascript" layout:fragment="script">
        function toggleAllCheckboxes(master) {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = master.checked;

                //  직접 함수 호출 대신 이벤트 트리거로 변경
                cb.dispatchEvent(new Event('change'));
            });
        }
        function markAsNotice(checkbox) {
            const tbody = document.querySelector("tbody");
            const allCheckboxes = tbody.querySelectorAll(".row-checkbox");

            allCheckboxes.forEach(cb => {
                if (cb !== checkbox) {
                    cb.checked = false;
                    cb.closest("tr").classList.remove("notice-row");
                }
            });
            const row = checkbox.closest("tr");
            const noticeTitle = row.querySelector("td:nth-child(2)").textContent.trim();

            if (checkbox.checked) {
                row.classList.add("notice-row");
                tbody.prepend(row);
                localStorage.setItem("noticePost", noticeTitle);
            } else {
                row.classList.remove("notice-row");
                tbody.append(row);
                localStorage.removeItem("noticePost");
            }
        }
        window.addEventListener('load', () => {
            const savedTitle = localStorage.getItem("noticePost");
            if (savedTitle) {
                const tbody = document.querySelector("tbody");
                const rows = Array.from(tbody.querySelectorAll("tr"));

                rows.forEach(row => {
                    const rowTitle = row.querySelector("td:nth-child(2)").textContent.trim();
                    const checkbox = row.querySelector(".row-checkbox");

                    if (rowTitle === savedTitle) {
                        row.classList.add("notice-row");
                        checkbox.checked = true;
                        tbody.prepend(row);
                    } else {
                        checkbox.checked = false;
                        row.classList.remove("notice-row");
                    }
                });
            }
        });
    </script>
</th:block>
</html>
